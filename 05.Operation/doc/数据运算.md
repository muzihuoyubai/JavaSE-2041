# 运算符

运算符用来表示数据的运算、赋值、比较。

## 算数运算符

java和c语言一样提供了基础的算数运算

| 运算符 | 说明                    | 示例       |
| ------ | ----------------------- | ---------- |
| +      | 加                      | a + b      |
| -      | 减                      | a - b      |
| *      | 乘                      | a * b      |
| /      | 除                      | a / b      |
| %      | 取余                    | a % b      |
| ++     | 自增                    | a++ 或 ++a |
| --     | 自减                    | a-- 或 --a |
| +      | 取a的值(加不加没有影响) | +a         |
| -      | 取a相反数               | -a         |

自增和自减运算和c语言类似，返回的值和运算符的位置有关，操作符前置则先计算赋值后返回值，后置则先返回值后计算赋值

java预置了处理复杂算数运算的方法比如科学类型计算，平方等，将在后续进行介绍

### 浮点运算的舍入误差

有关浮点数的舍入误差在c语言中也会出现，使用浮点数计算的时候，往往结果不是十分精确，因为十进制0.1这样的数保存到二进制系统里，是一个无限循环的数，再从内存中读取出来，可能会出现舍入误差。我们后续会介绍java提供的解决小数舍入误差的方式。

```
// 浮点数算数运算存在舍入误差
System.out.println(2.0 - 1.1); // 0.8999999999999999
```

### char类型参与算数运算

char类型可以参与算数运算，把值作为无符号的整数看待(0~65535)

```
// char类型可以参与算数运算，把值作为无符号的整数看待
System.out.println('a' + 4); // 'a'=97, + 4 =101
```

## 赋值运算符

对变量进行赋值，可以和算数、位运算符组合变为复合运算符

| 运算符 | 说明        | 示例    |
| ------ | ----------- | ------- |
| =      | 赋值        | a = b   |
| +=     | a = a + b   | a += b  |
| -=     | a = a - b   | a -= b  |
| *=     | a = a * b   | a *= b  |
| /=     | a = a / b   | a /= b  |
| %=     | a = a % b   | a %= b  |
| &=     | a = a & b   | a &= b  |
| \|=    | a = a \| b  | a \|= b |
| ^=     | a = a ^ b   | a ^= b  |
| <<=    | a = a << 4  | a<<=4   |
| >>=    | a = a >> 4  | a>>=4   |
| >>>=   | a = a >>> 4 | a>>>=4  |

赋值运算符左侧必须是变量，字面量不能被赋值

## 比较运算符

比较运算符用来判断两个数值的大小或比较两个变量引用是否相同，返回一个boolean类型的结果

| 运算符 | 说明                        | 示例   |
| ------ | --------------------------- | ------ |
| >      | a和b必须是数值              | a > b  |
| >=     | a和b必须是数值              | a >= b |
| <      | a和b必须是数值              | a < b  |
| <=     | a和b必须是数值              | a <= b |
| ==     | 数值、引用数据类型、boolean | a == b |
| !=     | 数值、引用数据类型、boolean | a != b |

对于参与运算的两个数值，可以是不同的数据类型，运算结果是比较数值是否相同。

对于`==`和`!=`

1. 如果操作数是boolean，则两边操作数必须都是boolean类型
2. 如果引用数据类型，用来比较两个引用是否指向了同一个对象地址。只有具备相同的数据类型的变量或是数据类型具备父子关系才能进行比较，不然编译报错。

```
System.out.println(5 >= 6); // false
System.out.println(7 <= 8.3); // true
System.out.println(3 != 4); // true
System.out.println(true == false); // false
System.out.println(1 == 1.1); // false
System.out.println(3 == 3.0); // true
```

## 逻辑运算符

逻辑运算符用于操作两个boolean类型的数值，返回一个boolean类型的结果

| 运算符 | 说明                    | 示例     |
| ------ | ----------------------- | -------- |
| &&     | 有一个false结果是false  | a && b   |
| \|\|   | 有一个是true结果是true  | a \|\| b |
| !      | 反转结果                | !a       |
| &      | 同&&                    | a & b    |
| \|     | 同\|                    | a \| b   |
| ^      | 相同为true，不同为false | a ^ b    |

### 短路

`&&`和`||` 当左边条件可以判断出最后的计算结果后，将不会进行右侧的表达式计算。直接返回boolean结果。

```
// 短路
int a = 1;
// 可以直接通过 && 左侧的false判断结果是false，右侧表达式不会进行计算
boolean and = false && (++a > 1);
System.out.println(and); // false
System.out.println(a); // 1
```

## 位运算符

根据内存中的二进制码按位操作

| 运算符 | 说明       | 示例  |
| ------ | ---------- | ----- |
| &      | 与         | a & b |
| \|     | 或         | a     |
| ~      | 非         | ~a    |
| ^      | 异或       | a ^ b |
| <<     | 左移       | a<<4  |
| >>     | 右移       | a>>4  |
| >>>    | 无符号右移 | a>>>4 |

> 左移或右移需要提供移动的位数，没有无符号左移

1. `&`、`|`、`^` 如果两边传入数值，则进行位运算，返回结果是数值，如果是boolean则进行逻辑运算，返回结果是boolean
2. `&` 和 `|` 不会出现短路的情况，我们建议使用`&&`和`||`，不要使用语言的默认机制来决定程序语句的执行

```
int a = 1;
// 不会出现短路的情况
boolean and = false & (++a > 1);
System.out.println(and); // false
System.out.println(a); // 2
```

## 三目运算符

三目运算可以根据条件决定哪个表达式的值为最终的运算结果。语法如下

```
(condition) ? exp1 : exp2
```

注意condition 必须是boolean类型值的表达式，exp1和exp为表达式,当condition为`true`则选择`exp1`作为结果，`false`则选择`exp2`作为结果，注意未被选择的表达式将不会被执行。

# 类型转换

当赋值或参与运算的两侧的操作数数据类型不一致，会按照规则进行数据类型转换，如果不满足数据类型转换规则的，编译器会报错，或者使用强制类型转换，根据原始的数据类型的值，得到一个新的数据类型的数值。

对于引用数据类型的类型转换后续将会介绍，这里只介绍数值相关的基本数据类型的类型转换。

## 赋值时的类型转换

赋值操作时，等号两边变量数据类型不一致，将按照规则进行隐式的数据类型转换。

以下图示表示，可以把箭头起始点的数据类型赋值给箭头指向的数据类型变量。

1. 实线箭头表示可以赋值，保存的信息不变
2. 虚线箭头表示可以赋值，但是保存的信息精度可能会损失
3. 没有箭头连接的数据类型不允许相互赋值，比如char和byte，箭头反向赋值也不允许，比如short赋值给byte，float赋值给int，这些赋值操作将会引起编译报错

![image](http://by-camp.oss-cn-shanghai.aliyuncs.com/wiki/Javase-online/images/0204_conversion.png)

```
byte byteNum = 12;
// 自动将byteNum的值转换成int，赋值给intNum
int intNum = byteNum;
// byteNum = intNum; // 编译报错，不允许这样的数据类型转换
// char charOne = byteNum; // 编译报错, 不允许这样的数据类型转换

intNum = 123456789;
float floatNum = intNum;
System.out.println(floatNum); // 1.23456792E8 只能保证最多7位精度
```

## 算数运算时的类型转换

若运算符两边的数据类型不一致，会先进行数据类型转换，之后再进行运算

- 如果任意一个是double类型，另一个操作数将会转换成double
- 否则，如果其中一个是float类型，另一个操作数将会转换成float
- 否则，如果其中一个操作数是long类型，另一个操作数将会转换成long
- 否则，两个操作数都将转换为int

> char、byte、short变量之间的算数运算结果都是int

```
// 小于int类型存储空间的数字数据类型的算数运算，都将转换成int类型进行计算
short shortTwo = 1;
short shortThree = 1;
shortTwo= (shortTwo + shortThree); // 编译报错，因为结果是int类型，不能再赋值给short
```

## 强制类型转换

可以通过指定数据类型来进行强制类型转换，强制类型转换的作用是将一种数据类型的值修改为另一个数据类型的值。（注意是值，不是把变量的数据类型转换了，也不是把里面的值修改了，而是根据变量中保存的值生成了另一个数据类型的值，原始值的还是不变的，除非重新赋值）

转换语法为

```
(数据类型) 变量或字面量
```

转换前后的数据类型的存储区域可能会有差异，通常有以下几种情况：

1. 大整数转小整数，高位截断，比如long类型强制转换为int
2. 小数转整数，小数截断，比如double强制转换为int
3. 小整数转大整数没有影响
4. 整数转小数，可能损失精度。

情况3和4类似于赋值时的类型转换。对于情况1和2

```
// 高位截断，截断32bit以上的所有位，剩下32bit
System.out.println((int) 0xFFFFFFFFFFL); // -1

double doubleOne = 9.9;
// 小数转整数将把小数部分截断
int intTwo = (int) doubleOne;
System.out.println(intTwo); // 9
```

组合的赋值运算符默认进行了强制类型转换

```
short shortTwo = 1;
short shortThree = 1;
shortTwo= (shortTwo + shortThree); // 编译报错，因为结果是int类型，不能再赋值给short
// 运算赋值符号一起的时候，默认进行了强制类型转换
// 相当于 shortTow = (short) (shortTwo + shortThree)
shortTwo += shortThree; // 可以正常运算
```

# 字符串的拼接

基本数据类型和字符串使用`+`号连接，会转变成数值对应的字符串

```
// 使用 + 号，拼接字符串
System.out.println("字符串：" + 15); // 字符串：15
System.out.println("字符串：" + 'a'); // 字符串：a
System.out.println("字符串：" + true); // 字符串：true
System.out.println("字符串：" + 3.14); // 字符串：3.14
```

注意拼接字符串时的运算执行的先后顺序对拼接结果的影响

```
System.out.println(3 + 4 + "字符串"); // 7字符串
System.out.println("字符串" + 3 + 4); // 字符串34
```

# 运算符的优先级

运算符的结合顺序按照优先级，相同优先级按照从左到右顺序运算。为了增加代码的可读性，尽量不要把一个计算表达式写的过于复杂，尽量使用`()`显示的指定运算结合的顺序。

| 运算符优先级从高到低 | 运算符                                  |
| -------------------- | --------------------------------------- |
| 单目运算符           | ++ -- ~ !                               |
| 强制类型转换         | (数据类型)                              |
| 算数运算符           | * / %                                   |
| 算数运算符           | + -                                     |
| 移位运算符           | << >> >>>                               |
| 比较运算符           | < <= >= >                               |
| 比较运算符           | == !=                                   |
| 位运算符             | &                                       |
| 位运算符             | ^                                       |
| 位运算符             | \|                                      |
| 逻辑运算符           | &&                                      |
| 逻辑运算符           | \|\|                                    |
| 赋值运算符           | = += -= *= /= &= \|= ^= %= <<= >>= >>>= |